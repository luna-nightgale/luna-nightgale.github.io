<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Time Scrubber</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for the slider and font */
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400..900&display=swap');
        
        .time-display {
            font-family: 'Orbitron', monospace;
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
            transition: all 0.3s ease-in-out; /* Smooth transition for size/color changes */
        }

        /* Styling for the unit buttons */
        .unit-button {
            transition: all 0.15s ease-in-out;
            @apply px-4 py-2 text-sm font-semibold rounded-lg bg-gray-700 text-gray-300 hover:bg-blue-600 hover:text-white border-2 border-transparent;
        }
        .unit-button.active {
            @apply bg-blue-500 text-white border-blue-300 shadow-md;
        }

        /* Styling the range input (slider) for better mobile touch target */
        input[type=range] {
            -webkit-appearance: none;
            width: 80%;
            height: 10px;
            background: #2d3748;
            border-radius: 50px; /* More rounded */
            cursor: pointer;
            outline: none;
            margin: 20px 0;
            transition: background 0.3s;
        }

        input[type=range]:hover {
            background: #4a5568;
        }

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 28px; /* Slightly larger thumb */
            height: 28px; /* Slightly larger thumb */
            border-radius: 50%;
            background: #38bdf8; /* Sky Blue */
            cursor: pointer;
            box-shadow: 0 0 8px rgba(56, 189, 248, 0.7); /* Stronger shadow */
            border: 2px solid #a78bfa; /* Added a border */
        }

        input[type=range]::-moz-range-thumb {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: #38bdf8;
            cursor: pointer;
            box-shadow: 0 0 8px rgba(56, 189, 248, 0.7);
            border: 2px solid #a78bfa;
        }
    </style>
    <script type="module">
        // --- Firebase Setup (Required for Canvas Environment) ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        
        let app, db, auth;
        try {
            app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            auth = getAuth(app);
            setLogLevel('Debug');
            if (initialAuthToken) {
                signInWithCustomToken(auth, initialAuthToken).then(() => {
                    console.log("Firebase signed in with custom token.");
                }).catch(error => {
                    console.error("Error signing in with custom token:", error);
                    signInAnonymously(auth);
                });
            } else {
                signInAnonymously(auth).then(() => {
                    console.log("Firebase signed in anonymously.");
                });
            }
        } catch (error) {
            console.error("Firebase initialization failed:", error);
        }
        // --- End Firebase Setup ---

        // --- Clock and Slider Logic ---
        const timeDisplay = document.getElementById('timeDisplay');
        const dateDisplay = document.getElementById('dateDisplay');
        const slider = document.getElementById('timeSlider');
        const stateMessage = document.getElementById('stateMessage');
        const offsetDisplay = document.getElementById('offsetDisplay');
        const modeLabel = document.getElementById('modeLabel');
        const sliderLabel = document.querySelector('label[for="timeSlider"]');
        const unitSelector = document.getElementById('unitSelector');
        
        // Global State Variables
        let mode = 'time'; // 'time' or 'date'
        let offsetUnit = 'seconds'; // 'seconds', 'days', 'months', 'years', 'decades', 'centuries'
        let intervalId = null;
        let isScrubbing = false;
        let scrubStartBaseTimeMs = Date.now(); // The time captured when scrubbing starts
        let scrubbedTimeMs = Date.now(); // The time/date that is ticking forward (M/D/Y/H/M/S)

        // Configuration for different scrubbing units
        const UNIT_CONFIG = {
            'seconds': { label: 'Seconds', max: 3 * 3600, limit: '3 Hours' },
            'days': { label: 'Days', max: 730, limit: '2 Years' },
            'months': { label: 'Months', max: 120, limit: '10 Years' },
            'years': { label: 'Years', max: 100, limit: '100 Years' },
            'decades': { label: 'Decades', max: 50, limit: '500 Years' },
            'centuries': { label: 'Centuries', max: 20, limit: '2000 Years' }
        };

        // Formats a number to always have two digits (e.g., 5 -> 05)
        const pad = (num) => num.toString().padStart(2, '0');

        /**
         * Renders the clock display based on the current mode and scrubbedTimeMs.
         */
        function renderDisplay() {
            const timeToDisplay = new Date(scrubbedTimeMs);

            if (mode === 'time') {
                // Time Scrubbing Mode: H:M:S and M/D/Y come from scrubbedTimeMs
                const hours = timeToDisplay.getHours();
                const minutes = timeToDisplay.getMinutes();
                const seconds = timeToDisplay.getSeconds();
                timeDisplay.textContent = `${pad(hours)}:${pad(minutes)}:${pad(seconds)}`;

                const month = timeToDisplay.getMonth() + 1;
                const day = timeToDisplay.getDate();
                const year = timeToDisplay.getFullYear();
                dateDisplay.textContent = `${pad(month)}/${pad(day)}/${year}`;
            
            } else { // mode === 'date'
                // Date Scrubbing Mode: Time (H:M:S) is live, Date (M/D/Y) comes from scrubbedTimeMs
                
                // Time Display: Use live system time for H:M:S
                const liveTime = new Date();
                const hours = liveTime.getHours();
                const minutes = liveTime.getMinutes();
                const seconds = liveTime.getSeconds();
                timeDisplay.textContent = `${pad(hours)}:${pad(minutes)}:${pad(seconds)}`;

                // Date Display: Use scrubbedTimeMs for M/D/Y
                const month = timeToDisplay.getMonth() + 1;
                const day = timeToDisplay.getDate();
                const year = timeToDisplay.getFullYear();
                dateDisplay.textContent = `${pad(month)}/${pad(day)}/${year}`;
            }
        }

        /**
         * Updates the offset display with appropriate units.
         * @param {number} offsetValue - The raw slider value (number of units).
         * @param {string} unit - The current offset unit ('seconds', 'days', etc.).
         */
        function updateOffsetDisplay(offsetValue, unit = offsetUnit) {
            let offsetString;
            
            if (unit === 'seconds') {
                // Format seconds into H:M:S
                const hours = Math.floor(offsetValue / 3600);
                const minutes = Math.floor((offsetValue % 3600) / 60);
                const seconds = offsetValue % 60;
                offsetString = `${pad(hours)}h ${pad(minutes)}m ${pad(seconds)}s`;
            } else if (unit === 'days') {
                const years = Math.floor(offsetValue / 365);
                const remainingDays = offsetValue % 365;
                // If years is 0, just show days
                offsetString = years > 0 
                    ? `${years}y ${remainingDays}d` 
                    : `${offsetValue} Days`;
            } else {
                // For Months, Years, Decades, Centuries, just show the count
                let unitLabel = unit.charAt(0).toUpperCase() + unit.slice(1);
                // Pluralize if necessary
                if (offsetValue !== 1) {
                    unitLabel = unitLabel.endsWith('s') ? unitLabel : unitLabel + 's';
                }
                offsetString = `${offsetValue} ${unitLabel}`;
            }
            offsetDisplay.textContent = offsetString;
        }

        /**
         * Starts the main clock interval, determining if it should track live time or tick forward.
         * @param {number} initialTimeMs - The starting timestamp.
         * @param {boolean} isLive - True if the clock should sync to Date.now() every tick.
         */
        function startClockInterval(initialTimeMs, isLive) {
            if (intervalId) {
                clearInterval(intervalId);
            }
            
            scrubbedTimeMs = initialTimeMs;
            
            // Set status messages
            let statusText = '';
            if (isLive) {
                statusText = mode === 'time' ? 'LIVE: Current System Time' : 'LIVE TIME / CURRENT DATE';
                stateMessage.classList.remove('text-yellow-400', 'text-blue-400');
                stateMessage.classList.add('text-green-400');
            } else {
                statusText = mode === 'time' ? 'RUNNING: From Scrubbed Time' : 'RUNNING: From Scrubbed Date';
                stateMessage.classList.remove('text-yellow-400', 'text-green-400');
                stateMessage.classList.add('text-blue-400');
            }
            stateMessage.textContent = statusText;

            renderDisplay();

            intervalId = setInterval(() => {
                if (!isScrubbing) {
                    // Only tick forward if we are in seconds mode OR if the unit is 'days' or greater (but only by seconds)
                    if (isLive && offsetUnit === 'seconds' && slider.value == 0) {
                        // In Time Mode, at zero offset: track system time
                        scrubbedTimeMs = Date.now();
                    } else {
                        // Scrubbed Time running forward (1 second per tick)
                        scrubbedTimeMs += 1000;
                    }
                    renderDisplay();
                }
            }, 1000);
        }

        /**
         * Switches the active offset unit (only applicable in Date Scrubbing mode).
         * @param {string} unit - The new offset unit.
         */
        function switchOffsetUnit(unit) {
            if (offsetUnit === unit && mode === 'date') return; 

            offsetUnit = unit;
            
            // Update button styles
            document.querySelectorAll('#unitSelector .unit-button').forEach(button => {
                button.classList.remove('active');
            });
            document.getElementById(`unit-${unit}`).classList.add('active');

            // Reset slider and update config
            const config = UNIT_CONFIG[unit];
            slider.max = config.max;
            slider.value = 0; 
            sliderLabel.textContent = `Slide Right to Move Forward (Up to ${config.limit})`;
            
            // Recalculate base time (to prevent jumps)
            scrubStartBaseTimeMs = Date.now();
            
            // Reset display
            handleSliderEnd(); // This will reset scrubbedTimeMs to Date.now() and restart the interval if offset is 0
        }

        /**
         * Handles the click to toggle between time and date scrubbing modes.
         * @param {string} newMode - 'time' or 'date'
         */
        function switchMode(newMode) {
            if (mode === newMode) return; // No change needed

            mode = newMode;
            const isDateMode = mode === 'date';

            // 1. Set the initial offset unit for the new mode
            offsetUnit = isDateMode ? 'days' : 'seconds';

            // 2. Toggle visibility of the unit selector
            unitSelector.classList.toggle('hidden', !isDateMode);
            
            // 3. Update Visuals (Adjusted font sizes)
            if (isDateMode) {
                // Date is big and blue, Time is small and gray
                dateDisplay.classList.remove('text-cyan-100', 'text-3xl', 'sm:text-5xl');
                dateDisplay.classList.add('text-blue-400', 'text-5xl', 'sm:text-7xl');
                
                timeDisplay.classList.remove('text-cyan-300', 'text-7xl', 'sm:text-9xl');
                timeDisplay.classList.add('text-gray-400', 'text-2xl', 'sm:text-4xl');
                
                modeLabel.textContent = 'Mode: Date Scrubbing';
                // Activate the initial unit button for Date mode ('days') and deactivate others
                document.querySelectorAll('#unitSelector .unit-button').forEach(button => {
                     button.classList.remove('active');
                });
                document.getElementById('unit-days').classList.add('active');

            } else {
                // Time is big and cyan, Date is small and white
                dateDisplay.classList.remove('text-blue-400', 'text-5xl', 'sm:text-7xl');
                dateDisplay.classList.add('text-cyan-100', 'text-3xl', 'sm:text-5xl');

                timeDisplay.classList.remove('text-gray-400', 'text-2xl', 'sm:text-4xl');
                timeDisplay.classList.add('text-cyan-300', 'text-7xl', 'sm:text-9xl');
                
                modeLabel.textContent = 'Mode: Time Scrubbing';
                // Deactivate all date unit buttons when switching to time mode
                document.querySelectorAll('#unitSelector .unit-button').forEach(button => {
                    button.classList.remove('active');
                });
            }
            
            // 4. Reset Time and Restart Interval (Live) - This also updates slider max/label/offset display
            scrubbedTimeMs = Date.now();
            scrubStartBaseTimeMs = Date.now();
            
            const config = UNIT_CONFIG[offsetUnit];
            slider.max = config.max;
            slider.value = 0;
            sliderLabel.textContent = `Slide Right to Move Forward (Up to ${config.limit})`;

            startClockInterval(Date.now(), true);
            updateOffsetDisplay(0);
        }

        /**
         * Called when the user starts interacting with the slider.
         */
        function handleSliderStart() {
            if (isScrubbing) return;
            
            clearInterval(intervalId); // Pause the ticking
            
            // Capture the current ticking time as the new base
            scrubStartBaseTimeMs = scrubbedTimeMs; 
            
            isScrubbing = true;

            stateMessage.textContent = 'PAUSED: Scrubbing Offset';
            stateMessage.classList.remove('text-green-400', 'text-blue-400');
            stateMessage.classList.add('text-yellow-400');
            
            // Immediately calculate and render the scrubbed time when starting to slide
            handleScrubbing();
        }

        /**
         * Called continuously while the slider is moved.
         */
        function handleScrubbing() {
            if (!isScrubbing) return; 

            const offsetValue = parseInt(slider.value, 10);
            let finalTimeMs;
            
            if (offsetUnit === 'seconds') {
                // Offset is in seconds
                finalTimeMs = scrubStartBaseTimeMs + (offsetValue * 1000);
            } else { 
                // Date-based offset (days, months, years, decades, centuries)
                // Use a copy of the base date to manipulate without side effects on base time
                const baseDate = new Date(scrubStartBaseTimeMs);

                // Note: setDate, setMonth, setFullYear handles day overflow automatically (e.g., setting month 13 rolls into the next year)
                if (offsetUnit === 'days') {
                    baseDate.setDate(baseDate.getDate() + offsetValue);
                } else if (offsetUnit === 'months') {
                    baseDate.setMonth(baseDate.getMonth() + offsetValue);
                } else if (offsetUnit === 'years') {
                    baseDate.setFullYear(baseDate.getFullYear() + offsetValue);
                } else if (offsetUnit === 'decades') {
                    baseDate.setFullYear(baseDate.getFullYear() + (offsetValue * 10));
                } else if (offsetUnit === 'centuries') {
                    baseDate.setFullYear(baseDate.getFullYear() + (offsetValue * 100));
                }
                finalTimeMs = baseDate.getTime();
            }

            updateOffsetDisplay(offsetValue, offsetUnit);

            // Temporarily set scrubbedTimeMs to the offset value for rendering static preview
            scrubbedTimeMs = finalTimeMs;
            renderDisplay();
        }

        /**
         * Called when the user stops interacting with the slider.
         */
        function handleSliderEnd() {
            isScrubbing = false;

            const finalOffsetValue = parseInt(slider.value, 10);
            
            if (finalOffsetValue === 0) {
                // If slider is back at zero, return to the live time/date clock
                startClockInterval(Date.now(), true);
                updateOffsetDisplay(0);
            } else {
                // Resume ticking from the scrubbed time/date (scrubbedTimeMs already holds the final offset value)
                startClockInterval(scrubbedTimeMs, false);
            }
        }
        
        // --- Initialization ---
        window.onload = function() {
            // Start the clock on load (live time)
            // Call switchMode('time') to initialize all variables and the UI correctly
            switchMode('time'); 

            // Attach mode switching listeners
            timeDisplay.addEventListener('click', () => switchMode('time'));
            dateDisplay.addEventListener('click', () => switchMode('date'));

            // Attach unit switching listeners
            document.getElementById('unit-days').addEventListener('click', () => switchOffsetUnit('days'));
            document.getElementById('unit-months').addEventListener('click', () => switchOffsetUnit('months'));
            document.getElementById('unit-years').addEventListener('click', () => switchOffsetUnit('years'));
            document.getElementById('unit-decades').addEventListener('click', () => switchOffsetUnit('decades'));
            document.getElementById('unit-centuries').addEventListener('click', () => switchOffsetUnit('centuries'));

            // Attach event listeners for mouse and touch interactions on the slider
            slider.addEventListener('input', handleScrubbing);
            slider.addEventListener('mousedown', handleSliderStart);
            slider.addEventListener('mouseup', handleSliderEnd);
            slider.addEventListener('touchstart', handleSliderStart);
            slider.addEventListener('touchend', handleSliderEnd);
            slider.addEventListener('touchcancel', handleSliderEnd); // Handle edge case
        };

    </script>
</head>
<body class="bg-gray-900 text-white min-h-screen flex flex-col items-center justify-center p-4">
    
    <!-- Main Content Area --><div class="w-full max-w-4xl text-center flex flex-col items-center p-8 space-y-8 bg-gray-800 rounded-2xl shadow-2xl border border-blue-700">
        
        <h1 class="text-4xl font-extrabold text-blue-400 tracking-wider">
            <span id="title">TIME SCRUBBER</span>
        </h1>

        <!-- Mode Indicator --><p id="modeLabel" class="text-lg font-medium tracking-wide text-gray-400">
            Mode: Time Scrubbing
        </p>

        <!-- Status Message --><p id="stateMessage" class="text-lg font-medium tracking-wide text-green-400 transition-colors duration-300">
            LIVE: Current System Time
        </p>

        <!-- Time Display (Clickable) --><div id="clockContainer" class="time-display flex flex-col items-center">
            <div id="timeDisplay" class="text-7xl sm:text-9xl font-bold text-cyan-300 cursor-pointer" title="Click to switch to Time Scrubbing Mode">
                --:--:--
            </div>
            <div id="dateDisplay" class="text-3xl sm:text-5xl font-light mt-4 text-cyan-100 cursor-pointer" title="Click to switch to Date Scrubbing Mode">
                --/--/----
            </div>
        </div>

        <!-- Time Offset Display --><div class="text-xl font-mono p-2 bg-gray-700 rounded-lg">
            <span class="text-gray-400">OFFSET:</span> 
            <span id="offsetDisplay" class="text-yellow-300 font-bold">00h 00m 00s</span>
        </div>
        
        <!-- Unit Selector for Date Mode (Hidden by default) -->
        <div id="unitSelector" class="hidden w-full flex justify-center flex-wrap gap-2 transition-all duration-300">
            <button id="unit-days" class="unit-button active">Days</button>
            <button id="unit-months" class="unit-button">Months</button>
            <button id="unit-years" class="unit-button">Years</button>
            <button id="unit-decades" class="unit-button">Decades</button>
            <button id="unit-centuries" class="unit-button">Centuries</button>
        </div>


        <!-- Slider Control --><div class="w-full flex flex-col items-center">
            <label for="timeSlider" class="text-gray-400 text-sm mb-2">
                Slide Right to Move Forward (Up to 3 Hours)
            </label>
            <input type="range" id="timeSlider" value="0" min="0">
        </div>

        <p class="text-sm text-gray-500">
            Current Application ID: <code class="bg-gray-700 p-1 rounded text-xs text-gray-300" id="appIdDisplay"></code>
        </p>
    </div>

    <!-- Script to display App ID --><script>
        document.getElementById('appIdDisplay').textContent = typeof __app_id !== 'undefined' ? __app_id : '237896';
    </script>
</body>
</html>
